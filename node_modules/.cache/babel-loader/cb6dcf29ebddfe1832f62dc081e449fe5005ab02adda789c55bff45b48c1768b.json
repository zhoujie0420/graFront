{"ast":null,"code":"import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport networkConfiguration from \"@/network/configuration\";\nimport usePeerStore from \"@/store/peer\";\nimport useFriendStore from \"@/store/friend\";\nimport { showToast } from \"vant\";\nexport function initializeWebSocketPlugin() {\n  console.log(\"invoked initialize websocket plugin\");\n  let peerStore = usePeerStore();\n  let friendStore = useFriendStore();\n  let {\n    host,\n    port,\n    path\n  } = {\n    ...networkConfiguration.server.webSocketServer\n  };\n  let connection = new ReconnectingWebSocket(`ws://${host}:${port}${path}/${peerStore.localPeer.id}`);\n  connection.onmessage = event => {\n    let message = JSON.parse(event.data);\n    friendStore.onlineList = message;\n    console.log(\"webSocketConnection.onmessage:\", message);\n  };\n  connection.onclose = event => {\n    console.log(\"webSocketConnection.onclose:\", event);\n    showToast(\"network connection closed\");\n  };\n  connection.onerror = event => {\n    console.log(\"webSocketConnection.onerror:\", event);\n    showToast(\"network connection error\");\n  };\n  connection.onopen = event => {\n    console.log(\"webSocketConnection.onopen:\", event);\n  };\n}\nexport default {\n  install(app) {\n    var _app$config$globalPro;\n    (_app$config$globalPro = app.config.globalProperties.$initializePeer) === null || _app$config$globalPro === void 0 ? void 0 : _app$config$globalPro.then(() => {\n      initializeWebSocketPlugin();\n    });\n  }\n};","map":{"version":3,"names":["ReconnectingWebSocket","networkConfiguration","usePeerStore","useFriendStore","showToast","initializeWebSocketPlugin","console","log","peerStore","friendStore","host","port","path","server","webSocketServer","connection","localPeer","id","onmessage","event","message","JSON","parse","data","onlineList","onclose","onerror","onopen","install","app","_app$config$globalPro","config","globalProperties","$initializePeer","then"],"sources":["/Users/jiezhou/IdeaProjects/graduationPro/web/src/plugins/initialize-websocket/index.js"],"sourcesContent":["import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport networkConfiguration from \"@/network/configuration\";\nimport usePeerStore from \"@/store/peer\";\nimport useFriendStore from \"@/store/friend\";\nimport {showToast} from \"vant\";\n\nexport function initializeWebSocketPlugin() {\n    console.log(\"invoked initialize websocket plugin\");\n    let peerStore = usePeerStore();\n    let friendStore = useFriendStore();\n\n    let {host, port, path} = {...networkConfiguration.server.webSocketServer};\n\n    let connection = new ReconnectingWebSocket(`ws://${host}:${port}${path}/${peerStore.localPeer.id}`);\n\n    connection.onmessage = event => {\n        let message = JSON.parse(event.data);\n        friendStore.onlineList = message;\n        console.log(\"webSocketConnection.onmessage:\", message);\n    };\n\n    connection.onclose = event => {\n        console.log(\"webSocketConnection.onclose:\", event);\n        showToast(\"network connection closed\");\n    };\n\n    connection.onerror = event => {\n        console.log(\"webSocketConnection.onerror:\", event);\n        showToast(\"network connection error\");\n    };\n\n    connection.onopen = event => {\n        console.log(\"webSocketConnection.onopen:\", event);\n    };\n}\n\nexport default {\n    install(app) {\n        app.config.globalProperties.$initializePeer?.then(() => {\n            initializeWebSocketPlugin();\n        });\n    }\n};"],"mappings":"AAAA,OAAOA,qBAAqB,MAAM,wBAAwB;AAC1D,OAAOC,oBAAoB,MAAM,yBAAyB;AAC1D,OAAOC,YAAY,MAAM,cAAc;AACvC,OAAOC,cAAc,MAAM,gBAAgB;AAC3C,SAAQC,SAAS,QAAO,MAAM;AAE9B,OAAO,SAASC,yBAAyBA,CAAA,EAAG;EACxCC,OAAO,CAACC,GAAG,CAAC,qCAAqC,CAAC;EAClD,IAAIC,SAAS,GAAGN,YAAY,CAAC,CAAC;EAC9B,IAAIO,WAAW,GAAGN,cAAc,CAAC,CAAC;EAElC,IAAI;IAACO,IAAI;IAAEC,IAAI;IAAEC;EAAI,CAAC,GAAG;IAAC,GAAGX,oBAAoB,CAACY,MAAM,CAACC;EAAe,CAAC;EAEzE,IAAIC,UAAU,GAAG,IAAIf,qBAAqB,CAAE,QAAOU,IAAK,IAAGC,IAAK,GAAEC,IAAK,IAAGJ,SAAS,CAACQ,SAAS,CAACC,EAAG,EAAC,CAAC;EAEnGF,UAAU,CAACG,SAAS,GAAGC,KAAK,IAAI;IAC5B,IAAIC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,CAAC;IACpCd,WAAW,CAACe,UAAU,GAAGJ,OAAO;IAChCd,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEa,OAAO,CAAC;EAC1D,CAAC;EAEDL,UAAU,CAACU,OAAO,GAAGN,KAAK,IAAI;IAC1Bb,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEY,KAAK,CAAC;IAClDf,SAAS,CAAC,2BAA2B,CAAC;EAC1C,CAAC;EAEDW,UAAU,CAACW,OAAO,GAAGP,KAAK,IAAI;IAC1Bb,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEY,KAAK,CAAC;IAClDf,SAAS,CAAC,0BAA0B,CAAC;EACzC,CAAC;EAEDW,UAAU,CAACY,MAAM,GAAGR,KAAK,IAAI;IACzBb,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAEY,KAAK,CAAC;EACrD,CAAC;AACL;AAEA,eAAe;EACXS,OAAOA,CAACC,GAAG,EAAE;IAAA,IAAAC,qBAAA;IACT,CAAAA,qBAAA,GAAAD,GAAG,CAACE,MAAM,CAACC,gBAAgB,CAACC,eAAe,cAAAH,qBAAA,uBAA3CA,qBAAA,CAA6CI,IAAI,CAAC,MAAM;MACpD7B,yBAAyB,CAAC,CAAC;IAC/B,CAAC,CAAC;EACN;AACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}