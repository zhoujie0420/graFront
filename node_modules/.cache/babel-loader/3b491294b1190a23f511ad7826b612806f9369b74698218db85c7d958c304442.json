{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, resolveDynamicComponent as _resolveDynamicComponent, openBlock as _openBlock, createBlock as _createBlock, KeepAlive as _KeepAlive, Fragment as _Fragment, createElementBlock as _createElementBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_van_divider = _resolveComponent(\"van-divider\");\n  const _component_van_button = _resolveComponent(\"van-button\");\n  const _component_van_notify = _resolveComponent(\"van-notify\");\n  const _component_router_view = _resolveComponent(\"router-view\");\n  const _component_van_tabbar_item = _resolveComponent(\"van-tabbar-item\");\n  const _component_van_tabbar = _resolveComponent(\"van-tabbar\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"section\", null, [_createVNode(_component_van_notify, {\n    show: $setup.peerStore.activateNotification,\n    \"onUpdate:show\": _cache[0] || (_cache[0] = $event => $setup.peerStore.activateNotification = $event),\n    background: \"rgb(0,0,0,.7)\"\n  }, {\n    default: _withCtx(() => {\n      var _$setup$peerStore$dat;\n      return [_createElementVNode(\"section\", null, [_createElementVNode(\"section\", null, _toDisplayString((_$setup$peerStore$dat = $setup.peerStore.dataConnection) === null || _$setup$peerStore$dat === void 0 ? void 0 : _$setup$peerStore$dat.peer) + \" 邀您视频通话 \", 1 /* TEXT */), _createVNode(_component_van_divider), _createElementVNode(\"section\", null, [_createVNode(_component_van_button, {\n        type: \"primary\",\n        size: \"small\",\n        onClick: $setup.acceptVideoCall\n      }, {\n        default: _withCtx(() => [_createTextVNode(\" 接受 \")]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_van_divider, {\n        vertical: \"\"\n      }), _createVNode(_component_van_button, {\n        type: \"danger\",\n        size: \"small\",\n        onClick: $setup.rejectVideoCall\n      }, {\n        default: _withCtx(() => [_createTextVNode(\" 拒绝 \")]),\n        _: 1 /* STABLE */\n      })])])];\n    }),\n\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"show\"])]), _createElementVNode(\"section\", null, [_createVNode(_component_router_view, null, {\n    default: _withCtx(({\n      Component\n    }) => [(_openBlock(), _createBlock(_KeepAlive, {\n      include: \"CommunicationView,SettingsView\"\n    }, [(_openBlock(), _createBlock(_resolveDynamicComponent(Component)))], 1024 /* DYNAMIC_SLOTS */))]),\n\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"section\", null, [_createVNode(_component_van_tabbar, {\n    modelValue: $setup.activatedTabBarItemIndex,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.activatedTabBarItemIndex = $event),\n    \"safe-area-inset-bottom\": \"\",\n    placeholder: \"\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_van_tabbar_item, {\n      icon: \"friends-o\",\n      to: \"/friends-list-view\"\n    }, {\n      default: _withCtx(() => [_createTextVNode(\" 朋友 \")]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_van_tabbar_item, {\n      icon: \"setting-o\",\n      to: \"/setting-view\"\n    }, {\n      default: _withCtx(() => [_createTextVNode(\" 设置 \")]),\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"])])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["_createElementVNode","_createVNode","_component_van_notify","show","$setup","peerStore","activateNotification","$event","background","_$setup$peerStore$dat","_toDisplayString","dataConnection","peer","_component_van_divider","_component_van_button","type","size","onClick","acceptVideoCall","vertical","rejectVideoCall","_component_router_view","Component","_createBlock","_KeepAlive","include","_resolveDynamicComponent","_component_van_tabbar","activatedTabBarItemIndex","placeholder","_component_van_tabbar_item","icon","to"],"sources":["/Users/jiezhou/IdeaProjects/web/src/views/MainEntranceView.vue"],"sourcesContent":["<template>\n  <section>\n    <van-notify v-model:show=\"peerStore.activateNotification\"\n                background=\"rgb(0,0,0,.7)\">\n      <section>\n        <section>\n          {{ peerStore.dataConnection?.peer }} 邀您视频通话\n        </section>\n\n        <van-divider/>\n\n        <section>\n          <van-button type=\"primary\"\n                      size=\"small\"\n                      @click=\"acceptVideoCall\">\n            接受\n          </van-button>\n\n          <van-divider vertical/>\n\n          <van-button type=\"danger\"\n                      size=\"small\"\n                      @click=\"rejectVideoCall\">\n            拒绝\n          </van-button>\n        </section>\n      </section>\n\n    </van-notify>\n  </section>\n\n  <section>\n    <router-view v-slot=\"{ Component }\">\n      <keep-alive include=\"CommunicationView,SettingsView\">\n        <component :is=\"Component\"/>\n      </keep-alive>\n    </router-view>\n  </section>\n\n\n\n  <section>\n    <van-tabbar v-model=\"activatedTabBarItemIndex\"\n                safe-area-inset-bottom\n                placeholder>\n\n      <van-tabbar-item icon=\"friends-o\"\n                       to=\"/friends-list-view\">\n        朋友\n      </van-tabbar-item>\n\n      <van-tabbar-item icon=\"setting-o\"\n                       to=\"/setting-view\">\n        设置\n      </van-tabbar-item>\n    </van-tabbar>\n  </section>\n</template>\n\n<script>\nexport default {\n  name: \"MainEntranceView\"\n}\n</script>\n\n<script setup>\nimport {ref, watch} from \"vue\";\nimport {showLoadingToast} from \"vant\";\nimport {useRouter} from \"vue-router\";\nimport usePeerStore from \"@/store/peer\";\n\n\nlet activatedTabBarItemIndex = ref(0);\n\nlet peerStore = usePeerStore();\n\nlet router = useRouter();\n\nfunction rejectVideoCall() {\n  peerStore.dataConnection.send({\n    instruction: peerStore.instruction.reject\n  });\n  peerStore.dataConnection = undefined;\n  peerStore.activateNotification = false;\n}\n\nfunction acceptVideoCall() {\n  peerStore.activateNotification = false;\n\n  let loadingToast = showLoadingToast({\n    duration: 0,\n    forbidClick: true,\n    loadingType: \"spinner\",\n    message: \"waiting for the other party to connect...\"\n  });\n\n  //监听媒体连接是否存在，有可能速度比较快，所以立即执行以下\n  let cancel = watch(() => peerStore.mediaConnection, newValue => {\n    if (newValue) {\n      //关闭加载框\n      loadingToast.close();\n\n      //取消监听；如果不取消会出现重复执行\n      cancel();\n\n      router.push({\n        path: \"/video-call-answer-view\"\n      });\n    }\n  }, {immediate: true});\n\n  peerStore.dataConnection.send({\n    instruction: peerStore.instruction.accept\n  });\n\n}\n</script>"],"mappings":";;;;;;;;6DACEA,mBAAA,CA4BU,kBA3BRC,YAAA,CA0BaC,qBAAA;IA1BOC,IAAI,EAAEC,MAAA,CAAAC,SAAS,CAACC,oBAAoB;yDAA9BF,MAAA,CAAAC,SAAS,CAACC,oBAAoB,GAAAC,MAAA;IAC5CC,UAAU,EAAC;;sBACrB;MAAA,IAAAC,qBAAA;MAAA,OAsBU,CAtBVT,mBAAA,CAsBU,kBArBRA,mBAAA,CAEU,iBAAAU,gBAAA,EAAAD,qBAAA,GADLL,MAAA,CAAAC,SAAS,CAACM,cAAc,cAAAF,qBAAA,uBAAxBA,qBAAA,CAA0BG,IAAI,IAAG,UACtC,iBAEAX,YAAA,CAAcY,sBAAA,GAEdb,mBAAA,CAcU,kBAbRC,YAAA,CAIaa,qBAAA;QAJDC,IAAI,EAAC,SAAS;QACdC,IAAI,EAAC,OAAO;QACXC,OAAK,EAAEb,MAAA,CAAAc;;0BAAiB,MAErC,C,iBAFqC,MAErC,E;;UAEAjB,YAAA,CAAuBY,sBAAA;QAAVM,QAAQ,EAAR;MAAQ,IAErBlB,YAAA,CAIaa,qBAAA;QAJDC,IAAI,EAAC,QAAQ;QACbC,IAAI,EAAC,OAAO;QACXC,OAAK,EAAEb,MAAA,CAAAgB;;0BAAiB,MAErC,C,iBAFqC,MAErC,E;;;;;;iCAORpB,mBAAA,CAMU,kBALRC,YAAA,CAIcoB,sBAAA;sBAHZ,CAEa;MAHQC;IAAS,Q,cAC9BC,YAAA,CAEaC,UAAA;MAFDC,OAAO,EAAC;IAAgC,K,cAClDF,YAAA,CAA4BG,wBAAA,CAAZJ,SAAS,I;;;QAO/BtB,mBAAA,CAeU,kBAdRC,YAAA,CAaa0B,qBAAA;gBAbQvB,MAAA,CAAAwB,wBAAwB;+DAAxBxB,MAAA,CAAAwB,wBAAwB,GAAArB,MAAA;IACjC,wBAAsB,EAAtB,EAAsB;IACtBsB,WAAW,EAAX;;sBAEV,MAGkB,CAHlB5B,YAAA,CAGkB6B,0BAAA;MAHDC,IAAI,EAAC,WAAW;MAChBC,EAAE,EAAC;;wBAAqB,MAEzC,C,iBAFyC,MAEzC,E;;QAEA/B,YAAA,CAGkB6B,0BAAA;MAHDC,IAAI,EAAC,WAAW;MAChBC,EAAE,EAAC;;wBAAgB,MAEpC,C,iBAFoC,MAEpC,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}