{"ast":null,"code":"import { ref, watch } from \"vue\";\nimport { showLoadingToast } from \"vant\";\nimport { useRouter } from \"vue-router\";\nimport usePeerStore from \"@/store/peer\";\nconst __default__ = {\n  name: \"MainEntranceView\"\n};\nexport default /*#__PURE__*/Object.assign(__default__, {\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    let activatedTabBarItemIndex = ref(0);\n    let peerStore = usePeerStore();\n    let router = useRouter();\n    function rejectVideoCall() {\n      peerStore.dataConnection.send({\n        instruction: peerStore.instruction.reject\n      });\n      peerStore.dataConnection = undefined;\n      peerStore.activateNotification = false;\n    }\n    function acceptVideoCall() {\n      peerStore.activateNotification = false;\n      let loadingToast = showLoadingToast({\n        duration: 0,\n        forbidClick: true,\n        loadingType: \"spinner\",\n        message: \"waiting for the other party to connect...\"\n      });\n\n      //监听媒体连接是否存在，有可能速度比较快，所以立即执行以下\n      let cancel = watch(() => peerStore.mediaConnection, newValue => {\n        if (newValue) {\n          //关闭加载框\n          loadingToast.close();\n\n          //取消监听；如果不取消会出现重复执行\n          cancel();\n          router.push({\n            path: \"/video-call-answer-view\"\n          });\n        }\n      }, {\n        immediate: true\n      });\n      peerStore.dataConnection.send({\n        instruction: peerStore.instruction.accept\n      });\n    }\n    const __returned__ = {\n      get activatedTabBarItemIndex() {\n        return activatedTabBarItemIndex;\n      },\n      set activatedTabBarItemIndex(v) {\n        activatedTabBarItemIndex = v;\n      },\n      get peerStore() {\n        return peerStore;\n      },\n      set peerStore(v) {\n        peerStore = v;\n      },\n      get router() {\n        return router;\n      },\n      set router(v) {\n        router = v;\n      },\n      rejectVideoCall,\n      acceptVideoCall,\n      ref,\n      watch,\n      get showLoadingToast() {\n        return showLoadingToast;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get usePeerStore() {\n        return usePeerStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n});","map":{"version":3,"names":["ref","watch","showLoadingToast","useRouter","usePeerStore","__default__","name","activatedTabBarItemIndex","peerStore","router","rejectVideoCall","dataConnection","send","instruction","reject","undefined","activateNotification","acceptVideoCall","loadingToast","duration","forbidClick","loadingType","message","cancel","mediaConnection","newValue","close","push","path","immediate","accept"],"sources":["/Users/jiezhou/IdeaProjects/graduationPro/web/src/views/MainEntranceView.vue"],"sourcesContent":["<template>\n  <section>\n    <van-notify v-model:show=\"peerStore.activateNotification\"\n                background=\"rgb(0,0,0,.7)\">\n      <section>\n        <section>\n          {{ peerStore.dataConnection?.peer }} 邀您视频通话\n        </section>\n\n        <van-divider/>\n\n        <section>\n          <van-button type=\"primary\"\n                      size=\"small\"\n                      @click=\"acceptVideoCall\">\n            接受\n          </van-button>\n\n          <van-divider vertical/>\n\n          <van-button type=\"danger\"\n                      size=\"small\"\n                      @click=\"rejectVideoCall\">\n            拒绝\n          </van-button>\n        </section>\n      </section>\n\n    </van-notify>\n  </section>\n\n  <section>\n    <router-view v-slot=\"{ Component }\">\n      <keep-alive include=\"CommunicationView,SettingsView\">\n        <component :is=\"Component\"/>\n      </keep-alive>\n    </router-view>\n  </section>\n\n\n\n  <section>\n    <van-tabbar v-model=\"activatedTabBarItemIndex\"\n                safe-area-inset-bottom\n                placeholder>\n\n      <van-tabbar-item icon=\"friends-o\"\n                       to=\"/friends-list-view\">\n        朋友\n      </van-tabbar-item>\n\n      <van-tabbar-item icon=\"setting-o\"\n                       to=\"/setting-view\">\n        设置\n      </van-tabbar-item>\n    </van-tabbar>\n  </section>\n</template>\n\n<script>\nexport default {\n  name: \"MainEntranceView\"\n}\n</script>\n\n<script setup>\nimport {ref, watch} from \"vue\";\nimport {showLoadingToast} from \"vant\";\nimport {useRouter} from \"vue-router\";\nimport usePeerStore from \"@/store/peer\";\n\n\nlet activatedTabBarItemIndex = ref(0);\n\nlet peerStore = usePeerStore();\n\nlet router = useRouter();\n\nfunction rejectVideoCall() {\n  peerStore.dataConnection.send({\n    instruction: peerStore.instruction.reject\n  });\n  peerStore.dataConnection = undefined;\n  peerStore.activateNotification = false;\n}\n\nfunction acceptVideoCall() {\n  peerStore.activateNotification = false;\n\n  let loadingToast = showLoadingToast({\n    duration: 0,\n    forbidClick: true,\n    loadingType: \"spinner\",\n    message: \"waiting for the other party to connect...\"\n  });\n\n  //监听媒体连接是否存在，有可能速度比较快，所以立即执行以下\n  let cancel = watch(() => peerStore.mediaConnection, newValue => {\n    if (newValue) {\n      //关闭加载框\n      loadingToast.close();\n\n      //取消监听；如果不取消会出现重复执行\n      cancel();\n\n      router.push({\n        path: \"/video-call-answer-view\"\n      });\n    }\n  }, {immediate: true});\n\n  peerStore.dataConnection.send({\n    instruction: peerStore.instruction.accept\n  });\n\n}\n</script>"],"mappings":"AAkEA,SAAQA,GAAG,EAAEC,KAAK,QAAO,KAAK;AAC9B,SAAQC,gBAAgB,QAAO,MAAM;AACrC,SAAQC,SAAS,QAAO,YAAY;AACpC,OAAOC,YAAY,MAAM,cAAc;AATvC,MAAAC,WAAA,GAAe;EACbC,IAAI,EAAE;AACR,CAAC;;;;;;IAUD,IAAIC,wBAAwB,GAAGP,GAAG,CAAC,CAAC,CAAC;IAErC,IAAIQ,SAAS,GAAGJ,YAAY,CAAC,CAAC;IAE9B,IAAIK,MAAM,GAAGN,SAAS,CAAC,CAAC;IAExB,SAASO,eAAeA,CAAA,EAAG;MACzBF,SAAS,CAACG,cAAc,CAACC,IAAI,CAAC;QAC5BC,WAAW,EAAEL,SAAS,CAACK,WAAW,CAACC;MACrC,CAAC,CAAC;MACFN,SAAS,CAACG,cAAc,GAAGI,SAAS;MACpCP,SAAS,CAACQ,oBAAoB,GAAG,KAAK;IACxC;IAEA,SAASC,eAAeA,CAAA,EAAG;MACzBT,SAAS,CAACQ,oBAAoB,GAAG,KAAK;MAEtC,IAAIE,YAAY,GAAGhB,gBAAgB,CAAC;QAClCiB,QAAQ,EAAE,CAAC;QACXC,WAAW,EAAE,IAAI;QACjBC,WAAW,EAAE,SAAS;QACtBC,OAAO,EAAE;MACX,CAAC,CAAC;;MAEF;MACA,IAAIC,MAAM,GAAGtB,KAAK,CAAC,MAAMO,SAAS,CAACgB,eAAe,EAAEC,QAAQ,IAAI;QAC9D,IAAIA,QAAQ,EAAE;UACZ;UACAP,YAAY,CAACQ,KAAK,CAAC,CAAC;;UAEpB;UACAH,MAAM,CAAC,CAAC;UAERd,MAAM,CAACkB,IAAI,CAAC;YACVC,IAAI,EAAE;UACR,CAAC,CAAC;QACJ;MACF,CAAC,EAAE;QAACC,SAAS,EAAE;MAAI,CAAC,CAAC;MAErBrB,SAAS,CAACG,cAAc,CAACC,IAAI,CAAC;QAC5BC,WAAW,EAAEL,SAAS,CAACK,WAAW,CAACiB;MACrC,CAAC,CAAC;IAEJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}