{"ast":null,"code":"import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport networkConfiguration from \"@/network/configuration\";\nimport useFriendStore from \"@/store/friend\";\nimport { showToast } from \"vant\";\nimport $ from \"jquery\";\nimport { apiUrl } from \"../../../config\";\nimport router from \"@/router\";\nexport default function initializeWebsocket(username) {\n  let friendStore = useFriendStore();\n  let {\n    host,\n    port,\n    path\n  } = {\n    ...networkConfiguration.server.webSocketServer\n  };\n  let connection = new ReconnectingWebSocket(`ws://${host}:${port}${path}/${username}`);\n  connection.onmessage = event => {\n    let message = JSON.parse(event.data);\n    friendStore.onlineList = message;\n    console.log(\"webSocketConnection.onmessage:\", message);\n  };\n  connection.onclose = event => {\n    console.log(\"webSocketConnection.onclose:\", event);\n    showToast(\"network connection closed\");\n  };\n  connection.onerror = event => {\n    console.log(\"webSocketConnection.onerror:\", event);\n    showToast(\"network connection error\");\n  };\n  connection.onopen = event => {\n    console.log(\"webSocketConnection.onopen:\", event);\n  };\n}","map":{"version":3,"names":["ReconnectingWebSocket","networkConfiguration","useFriendStore","showToast","$","apiUrl","router","initializeWebsocket","username","friendStore","host","port","path","server","webSocketServer","connection","onmessage","event","message","JSON","parse","data","onlineList","console","log","onclose","onerror","onopen"],"sources":["/Users/jiezhou/IdeaProjects/web/src/plugins/initialize-websocket/index.js"],"sourcesContent":["import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport networkConfiguration from \"@/network/configuration\";\nimport useFriendStore from \"@/store/friend\";\nimport {showToast} from \"vant\";\nimport $ from \"jquery\";\nimport {apiUrl} from \"../../../config\";\nimport router from \"@/router\";\n\nexport default function initializeWebsocket (username) {\n    let friendStore = useFriendStore();\n\n    let {host, port, path} = {...networkConfiguration.server.webSocketServer};\n    let connection = new ReconnectingWebSocket(`ws://${host}:${port}${path}/${username}`);\n    connection.onmessage = event => {\n        let message = JSON.parse(event.data);\n\n        friendStore.onlineList = message;\n        console.log(\"webSocketConnection.onmessage:\", message);\n    };\n\n    connection.onclose = event => {\n        console.log(\"webSocketConnection.onclose:\", event);\n        showToast(\"network connection closed\");\n    };\n\n    connection.onerror = event => {\n        console.log(\"webSocketConnection.onerror:\", event);\n        showToast(\"network connection error\");\n    };\n\n    connection.onopen = event => {\n        console.log(\"webSocketConnection.onopen:\", event);\n    };\n}\n\n"],"mappings":"AAAA,OAAOA,qBAAqB,MAAM,wBAAwB;AAC1D,OAAOC,oBAAoB,MAAM,yBAAyB;AAC1D,OAAOC,cAAc,MAAM,gBAAgB;AAC3C,SAAQC,SAAS,QAAO,MAAM;AAC9B,OAAOC,CAAC,MAAM,QAAQ;AACtB,SAAQC,MAAM,QAAO,iBAAiB;AACtC,OAAOC,MAAM,MAAM,UAAU;AAE7B,eAAe,SAASC,mBAAmBA,CAAEC,QAAQ,EAAE;EACnD,IAAIC,WAAW,GAAGP,cAAc,CAAC,CAAC;EAElC,IAAI;IAACQ,IAAI;IAAEC,IAAI;IAAEC;EAAI,CAAC,GAAG;IAAC,GAAGX,oBAAoB,CAACY,MAAM,CAACC;EAAe,CAAC;EACzE,IAAIC,UAAU,GAAG,IAAIf,qBAAqB,CAAE,QAAOU,IAAK,IAAGC,IAAK,GAAEC,IAAK,IAAGJ,QAAS,EAAC,CAAC;EACrFO,UAAU,CAACC,SAAS,GAAGC,KAAK,IAAI;IAC5B,IAAIC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,CAAC;IAEpCZ,WAAW,CAACa,UAAU,GAAGJ,OAAO;IAChCK,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEN,OAAO,CAAC;EAC1D,CAAC;EAEDH,UAAU,CAACU,OAAO,GAAGR,KAAK,IAAI;IAC1BM,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEP,KAAK,CAAC;IAClDd,SAAS,CAAC,2BAA2B,CAAC;EAC1C,CAAC;EAEDY,UAAU,CAACW,OAAO,GAAGT,KAAK,IAAI;IAC1BM,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEP,KAAK,CAAC;IAClDd,SAAS,CAAC,0BAA0B,CAAC;EACzC,CAAC;EAEDY,UAAU,CAACY,MAAM,GAAGV,KAAK,IAAI;IACzBM,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAEP,KAAK,CAAC;EACrD,CAAC;AACL"},"metadata":{},"sourceType":"module","externalDependencies":[]}