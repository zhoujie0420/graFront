{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createBlock as _createBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 0\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_van_nav_bar = _resolveComponent(\"van-nav-bar\");\n  const _component_van_search = _resolveComponent(\"van-search\");\n  const _component_van_divider = _resolveComponent(\"van-divider\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"section\", null, [_createVNode(_component_van_nav_bar, {\n    title: \"朋友\",\n    fixed: \"\",\n    placeholder: \"\",\n    \"safe-area-inset-top\": \"\"\n  })]), _createElementVNode(\"section\", null, [_createVNode(_component_van_search, {\n    placeholder: \"请输入搜索关键词\"\n  })]), $setup.friendStore.onlineList.length ? (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [_createVNode(_component_van_divider, null, {\n    default: _withCtx(() => [_createTextVNode(\"在线的朋友 轻触可开始视频聊天\")]),\n    _: 1 /* STABLE */\n  }), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.friendStore.onlineList, peerId => {\n    return _openBlock(), _createElementBlock(\"section\", {\n      key: peerId\n    }, [peerId === $setup.peerStore.localPeer.id ? (_openBlock(), _createBlock($setup[\"FriendCard\"], {\n      key: 0\n    }, {\n      default: _withCtx(() => [_createTextVNode(_toDisplayString(peerId) + \"(我) \", 1 /* TEXT */)]),\n\n      _: 2 /* DYNAMIC */\n    }, 1024 /* DYNAMIC_SLOTS */)) : _createCommentVNode(\"v-if\", true), $setup.getRole(peerId) === $setup.getRole($setup.peerStore.localPeer.id) ? (_openBlock(), _createBlock($setup[\"FriendCard\"], {\n      key: 1,\n      onClick: $event => $setup.jumpToVideoCallCallingView(peerId)\n    }, {\n      default: _withCtx(() => [_createTextVNode(_toDisplayString(peerId), 1 /* TEXT */)]),\n\n      _: 2 /* DYNAMIC */\n    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true)]);\n  }), 128 /* KEYED_FRAGMENT */))])) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["_createElementVNode","_createVNode","_component_van_nav_bar","title","fixed","placeholder","_component_van_search","$setup","friendStore","onlineList","length","_createElementBlock","_hoisted_1","_component_van_divider","_Fragment","_renderList","peerId","key","peerStore","localPeer","id","_createBlock","getRole","onClick","$event","jumpToVideoCallCallingView"],"sources":["/Users/jiezhou/IdeaProjects/web/src/views/FriendsListView.vue"],"sourcesContent":["<template>\n  <section>\n    <van-nav-bar title=\"朋友\"\n                 fixed\n                 placeholder\n                 safe-area-inset-top/>\n  </section>\n\n  <section>\n    <van-search placeholder=\"请输入搜索关键词\"/>\n  </section>\n\n  <section v-if=\"friendStore.onlineList.length\">\n    <van-divider>在线的朋友 轻触可开始视频聊天</van-divider>\n\n    <section v-for=\"peerId of friendStore.onlineList\"\n             :key=\"peerId\">\n      <friend-card v-if=\"peerId === peerStore.localPeer.id\">\n        {{ peerId }}(我)\n      </friend-card>\n      <friend-card v-if=\"getRole(peerId) === getRole(peerStore.localPeer.id)\"\n                   @click=\"jumpToVideoCallCallingView(peerId)\">\n        {{ peerId }}\n      </friend-card>\n    </section>\n  </section>\n</template>\n\n<script setup>\nimport useFriendStore from \"@/store/friend\";\nimport usePeerStore from \"@/store/peer\";\nimport FriendCard from \"@/components/FriendCard.vue\";\nimport {useRouter} from \"vue-router\";\nimport {showToast} from \"vant\";\nimport $ from \"jquery\";\nimport {apiUrl} from \"../../config\";\nimport initializePeer from \"@/plugins/initialize-peer\";\nimport initializeWebsocket from \"@/plugins/initialize-websocket\";\n\nlet friendStore = useFriendStore();\nlet peerStore = usePeerStore();\n\nlet router = useRouter();\n\nfunction jumpToVideoCallCallingView(calleePeerId) {\n  console.log(\"adqweqx\" + calleePeerId);\n  if (peerStore.localPeer && peerStore.localPeer.open) {\n    if (peerStore.dataConnection) {\n      showToast(\"currently busy\");\n    } else {\n      router.push({\n        path: \"/video-call-calling-view\",\n        query: {\n          calleePeerId\n        }\n      });\n    }\n  } else {\n    showToast(\"local peer not opened\");\n  }\n}\n\n\nfunction getRole(peerId) {\n  $.ajax({\n    url: `${apiUrl}/api/user/account/getRole/`,\n    type: \"get\",\n    headers: {\n      Authorization: \"Bearer \" + peerStore.token,\n    },\n    success(resp) {\n      if (resp.code === 200) {\n        return resp.data.role;\n      } else {\n        console.log(resp.message)\n      }\n    },\n    error(resp) {\n      console.log(resp)\n    }\n  })\n}\n</script>"],"mappings":";;;;;;;;6DACEA,mBAAA,CAKU,kBAJRC,YAAA,CAGkCC,sBAAA;IAHrBC,KAAK,EAAC,IAAI;IACVC,KAAK,EAAL,EAAK;IACLC,WAAW,EAAX,EAAW;IACX,qBAAmB,EAAnB;QAGfL,mBAAA,CAEU,kBADRC,YAAA,CAAoCK,qBAAA;IAAxBD,WAAW,EAAC;EAAU,G,GAGrBE,MAAA,CAAAC,WAAW,CAACC,UAAU,CAACC,MAAM,I,cAA5CC,mBAAA,CAaU,WAAAC,UAAA,GAZRX,YAAA,CAA0CY,sBAAA;sBAA7B,MAAe,C,iBAAf,iBAAe,E;;yBAE5BF,mBAAA,CASUG,SAAA,QAAAC,WAAA,CATgBR,MAAA,CAAAC,WAAW,CAACC,UAAU,EAAhCO,MAAM;yBAAtBL,mBAAA,CASU;MARAM,GAAG,EAAED;IAAM,IACAA,MAAM,KAAKT,MAAA,CAAAW,SAAS,CAACC,SAAS,CAACC,EAAE,I,cAApDC,YAAA,CAEcd,MAAA;MAAAU,GAAA;IAAA;wBADZ,MAAY,C,kCAATD,MAAM,IAAG,MACd,gB;;;uEACmBT,MAAA,CAAAe,OAAO,CAACN,MAAM,MAAMT,MAAA,CAAAe,OAAO,CAACf,MAAA,CAAAW,SAAS,CAACC,SAAS,CAACC,EAAE,K,cAArEC,YAAA,CAGcd,MAAA;;MAFAgB,OAAK,EAAAC,MAAA,IAAEjB,MAAA,CAAAkB,0BAA0B,CAACT,MAAM;;wBACpD,MAAY,C,kCAATA,MAAM,iB"},"metadata":{},"sourceType":"module","externalDependencies":[]}