{"ast":null,"code":"import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport networkConfiguration from \"@/network/configuration\";\nimport usePeerStore from \"@/store/peer\";\nimport useFriendStore from \"@/store/friend\";\nimport { showToast } from \"vant\";\nexport default {\n  install(app) {\n    var _app$config$globalPro;\n    console.log(\"invoked initialize websocket plugin\");\n    (_app$config$globalPro = app.config.globalProperties.$initializePeer) === null || _app$config$globalPro === void 0 ? void 0 : _app$config$globalPro.then(() => {\n      let peerStore = usePeerStore();\n      let friendStore = useFriendStore();\n      let {\n        host,\n        port,\n        path\n      } = {\n        ...networkConfiguration.server.webSocketServer\n      };\n      let connection = new ReconnectingWebSocket(`ws://${host}:${port}${path}/${peerStore.localPeer.id}`);\n      connection.onmessage = event => {\n        let message = JSON.parse(event.data);\n        friendStore.onlineList = message;\n        console.log(\"webSocketConnection.onmessage:\", message);\n      };\n      connection.onclose = event => {\n        console.log(\"webSocketConnection.onclose:\", event);\n        showToast(\"network connection closed\");\n      };\n      connection.onerror = event => {\n        console.log(\"webSocketConnection.onerror:\", event);\n        showToast(\"network connection error\");\n      };\n      connection.onopen = event => {\n        console.log(\"webSocketConnection.onopen:\", event);\n      };\n    });\n  }\n};","map":{"version":3,"names":["ReconnectingWebSocket","networkConfiguration","usePeerStore","useFriendStore","showToast","install","app","_app$config$globalPro","console","log","config","globalProperties","$initializePeer","then","peerStore","friendStore","host","port","path","server","webSocketServer","connection","localPeer","id","onmessage","event","message","JSON","parse","data","onlineList","onclose","onerror","onopen"],"sources":["/Users/jiezhou/IdeaProjects/graduationPro/web/src/plugins/initialize-websocket/index.js"],"sourcesContent":["import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport networkConfiguration from \"@/network/configuration\";\nimport usePeerStore from \"@/store/peer\";\nimport useFriendStore from \"@/store/friend\";\nimport {showToast} from \"vant\";\n\nexport default {\n    install(app) {\n        console.log(\"invoked initialize websocket plugin\");\n        app.config.globalProperties.$initializePeer?.then(() => {\n            let peerStore = usePeerStore();\n            let friendStore = useFriendStore();\n\n            let {host, port, path} = {...networkConfiguration.server.webSocketServer};\n\n            let connection = new ReconnectingWebSocket(`ws://${host}:${port}${path}/${peerStore.localPeer.id}`);\n\n            connection.onmessage = event => {\n                let message = JSON.parse(event.data);\n                friendStore.onlineList = message;\n                console.log(\"webSocketConnection.onmessage:\", message);\n            };\n\n            connection.onclose = event => {\n                console.log(\"webSocketConnection.onclose:\", event);\n                showToast(\"network connection closed\");\n            };\n\n            connection.onerror = event => {\n                console.log(\"webSocketConnection.onerror:\", event);\n                showToast(\"network connection error\");\n            };\n\n            connection.onopen = event => {\n                console.log(\"webSocketConnection.onopen:\", event);\n            };\n        });\n    }\n};"],"mappings":"AAAA,OAAOA,qBAAqB,MAAM,wBAAwB;AAC1D,OAAOC,oBAAoB,MAAM,yBAAyB;AAC1D,OAAOC,YAAY,MAAM,cAAc;AACvC,OAAOC,cAAc,MAAM,gBAAgB;AAC3C,SAAQC,SAAS,QAAO,MAAM;AAE9B,eAAe;EACXC,OAAOA,CAACC,GAAG,EAAE;IAAA,IAAAC,qBAAA;IACTC,OAAO,CAACC,GAAG,CAAC,qCAAqC,CAAC;IAClD,CAAAF,qBAAA,GAAAD,GAAG,CAACI,MAAM,CAACC,gBAAgB,CAACC,eAAe,cAAAL,qBAAA,uBAA3CA,qBAAA,CAA6CM,IAAI,CAAC,MAAM;MACpD,IAAIC,SAAS,GAAGZ,YAAY,CAAC,CAAC;MAC9B,IAAIa,WAAW,GAAGZ,cAAc,CAAC,CAAC;MAElC,IAAI;QAACa,IAAI;QAAEC,IAAI;QAAEC;MAAI,CAAC,GAAG;QAAC,GAAGjB,oBAAoB,CAACkB,MAAM,CAACC;MAAe,CAAC;MAEzE,IAAIC,UAAU,GAAG,IAAIrB,qBAAqB,CAAE,QAAOgB,IAAK,IAAGC,IAAK,GAAEC,IAAK,IAAGJ,SAAS,CAACQ,SAAS,CAACC,EAAG,EAAC,CAAC;MAEnGF,UAAU,CAACG,SAAS,GAAGC,KAAK,IAAI;QAC5B,IAAIC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,CAAC;QACpCd,WAAW,CAACe,UAAU,GAAGJ,OAAO;QAChClB,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEiB,OAAO,CAAC;MAC1D,CAAC;MAEDL,UAAU,CAACU,OAAO,GAAGN,KAAK,IAAI;QAC1BjB,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEgB,KAAK,CAAC;QAClDrB,SAAS,CAAC,2BAA2B,CAAC;MAC1C,CAAC;MAEDiB,UAAU,CAACW,OAAO,GAAGP,KAAK,IAAI;QAC1BjB,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEgB,KAAK,CAAC;QAClDrB,SAAS,CAAC,0BAA0B,CAAC;MACzC,CAAC;MAEDiB,UAAU,CAACY,MAAM,GAAGR,KAAK,IAAI;QACzBjB,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAEgB,KAAK,CAAC;MACrD,CAAC;IACL,CAAC,CAAC;EACN;AACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}