{"ast":null,"code":"import { ref } from \"vue\";\nimport $ from \"jquery\";\nimport { apiUrl } from \"../../config\";\nimport router from \"@/router\";\nimport usePeerStore from \"@/store/peer\";\nimport initializeWebsocket from \"@/plugins/initialize-websocket\";\nimport initializePeer from \"@/plugins/initialize-peer\";\nexport default {\n  __name: 'LoginView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const username = ref('');\n    const password = ref('');\n    const peerStore = usePeerStore();\n    const message = ref('');\n    const login = () => {\n      $.ajax({\n        url: `${apiUrl}/api/user/account/token/`,\n        type: \"post\",\n        data: {\n          username: username.value,\n          password: password.value\n        },\n        success(resp) {\n          if (resp.code === 200) {\n            // peerStore.token = resp.data.token;\n            getInfo();\n            router.push(\"/setting-view\");\n          } else {\n            message.value = resp.message;\n          }\n        }\n      });\n    };\n    function getInfo() {\n      $.ajax({\n        url: `${apiUrl}/api/user/account/info/`,\n        type: \"get\",\n        headers: {\n          Authorization: \"Bearer \" + peerStore.token\n        },\n        success(resp) {\n          if (resp.code === 200) {\n            peerStore.username = resp.data.username;\n            peerStore.is_login = true;\n            peerStore.phone = resp.data.phone;\n            peerStore.role = resp.data.role;\n            router.push(\"/setting-view\");\n            // initializePeer(username.value);\n            // initializeWebsocket(username.value);\n          } else {\n            console.log(resp.message);\n          }\n        },\n        error(resp) {\n          console.log(resp);\n        }\n      });\n    }\n    const jwt_token = localStorage.getItem(\"jwt_token\");\n    if (jwt_token) {\n      peerStore.token = jwt_token;\n      try {\n        peerStore.getInfo({\n          success() {\n            router.push(\"/setting-view\");\n            peerStore.pulling_info = false;\n          },\n          error() {\n            peerStore.pulling_info = false;\n          }\n        });\n        peerStore.pulling_info = false;\n      } catch (e) {\n        console.log(e);\n        peerStore.pulling_info = false;\n      }\n    } else {\n      peerStore.pulling_info = false;\n    }\n    const __returned__ = {\n      username,\n      password,\n      peerStore,\n      message,\n      login,\n      getInfo,\n      jwt_token,\n      ref,\n      get $() {\n        return $;\n      },\n      get apiUrl() {\n        return apiUrl;\n      },\n      get router() {\n        return router;\n      },\n      get usePeerStore() {\n        return usePeerStore;\n      },\n      get initializeWebsocket() {\n        return initializeWebsocket;\n      },\n      get initializePeer() {\n        return initializePeer;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","$","apiUrl","router","usePeerStore","initializeWebsocket","initializePeer","username","password","peerStore","message","login","ajax","url","type","data","value","success","resp","code","getInfo","push","headers","Authorization","token","is_login","phone","role","console","log","error","jwt_token","localStorage","getItem","pulling_info","e"],"sources":["/Users/jiezhou/IdeaProjects/graduationPro/web/src/views/LoginView.vue"],"sourcesContent":["<template>\n  <div class=\"login-container\">\n    <h2>登录</h2>\n    <form @submit.prevent=\"login\">\n      <input type=\"text\" v-model=\"username\" placeholder=\"用户名\"/>\n      <input type=\"password\" v-model=\"password\" placeholder=\"密码\"/>\n      <div class=\"login-error-msg\">{{ message }}</div>\n      <button type=\"submit\">登录</button>\n    </form>\n    <p>还没有账号？\n      <router-link to=\"/register-view\">立即注册</router-link>\n    </p>\n  </div>\n</template>\n\n<script setup>\nimport {ref} from \"vue\";\nimport $ from \"jquery\";\nimport {apiUrl} from \"../../config\";\nimport router from \"@/router\";\nimport usePeerStore from \"@/store/peer\";\nimport initializeWebsocket from \"@/plugins/initialize-websocket\";\nimport initializePeer from \"@/plugins/initialize-peer\";\n\nconst username = ref('');\nconst password = ref('');\nconst peerStore = usePeerStore();\nconst message = ref('');\n\nconst login = () => {\n  $.ajax({\n    url: `${apiUrl}/api/user/account/token/`,\n    type: \"post\",\n    data: {\n      username: username.value,\n      password: password.value,\n    },\n    success(resp) {\n      if (resp.code === 200) {\n        // peerStore.token = resp.data.token;\n        getInfo();\n        router.push(\"/setting-view\");\n      } else {\n        message.value = resp.message;\n      }\n    },\n  });\n}\n\nfunction getInfo() {\n  $.ajax({\n    url: `${apiUrl}/api/user/account/info/`,\n    type: \"get\",\n    headers: {\n      Authorization: \"Bearer \" + peerStore.token,\n    },\n    success(resp) {\n      if (resp.code === 200) {\n        peerStore.username = resp.data.username;\n        peerStore.is_login = true;\n        peerStore.phone = resp.data.phone;\n        peerStore.role = resp.data.role;\n        router.push(\"/setting-view\");\n        // initializePeer(username.value);\n        // initializeWebsocket(username.value);\n      } else {\n        console.log(resp.message)\n      }\n    },\n    error(resp) {\n      console.log(resp)\n    }\n  })\n}\nconst jwt_token = localStorage.getItem(\"jwt_token\");\nif (jwt_token) {\n  peerStore.token = jwt_token;\n  try {\n    peerStore.getInfo({\n      success() {\n        router.push(\"/setting-view\");\n        peerStore.pulling_info = false\n      },\n      error() {\n        peerStore.pulling_info = false\n      }\n    });\n    peerStore.pulling_info = false\n  } catch (e) {\n    console.log(e)\n    peerStore.pulling_info = false\n  }\n} else {\n  peerStore.pulling_info = false\n}\n\n</script>\n\n\n<!-- 样式略 -->\n\n<style scoped>\n.login-container {\n  max-width: 400px;\n  margin: 0 auto;\n  padding: 20px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n}\n\n.login-container h2 {\n  text-align: center;\n}\n\n.login-container form {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  margin-top: 20px;\n}\n\n.login-container input[type=\"text\"],\n.login-container input[type=\"password\"] {\n  padding: 8px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n}\n\n.login-container button {\n  padding: 8px;\n  background-color: #007bff;\n  color: #fff;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n}\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}